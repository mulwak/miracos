; -------------------------------------------------------------------
;                           Bellコマンド
; -------------------------------------------------------------------
; ジングルベルを鳴らす
; シンプルBGMの礎となる
; -------------------------------------------------------------------
.INCLUDE "../FXT65.inc"
.INCLUDE "../generic.mac"
.INCLUDE "../fs/structfs.s"
.INCLUDE "../fscons.inc"
.PROC BCOS
  .INCLUDE "../syscall.inc"  ; システムコール番号
.ENDPROC
.INCLUDE "../syscall.mac"

; -------------------------------------------------------------------
;                           実行用ライブラリ
; -------------------------------------------------------------------
  .INCLUDE "./+bell/ymzq/ymzq.s"

; -------------------------------------------------------------------
;                               ZP領域
; -------------------------------------------------------------------
.ZEROPAGE
  ; VBLANK
  ZP_VB_STUB:         .RES 2        ; 割り込み終了処理

; -------------------------------------------------------------------
;                              変数領域
; -------------------------------------------------------------------
.BSS

; -------------------------------------------------------------------
;                             実行領域
; -------------------------------------------------------------------
.CODE
INIT:
  ; ---------------------------------------------------------------
  ;   YMZ
  init_ymzq
  ; ---------------------------------------------------------------
  ;   割り込みハンドラの登録
  SEI
  loadAY16 VBLANK
  syscall IRQ_SETHNDR_VB
  storeAY16 ZP_VB_STUB
  CLI

  LDX #0
  loadAY16 NOTES
  JSR PLAY

MAIN:
  BRA MAIN

; -------------------------------------------------------------------
;                          垂直同期割り込み
; -------------------------------------------------------------------
VBLANK:
TICK:
  tick_ymzq                   ; コマンド処理
  JMP (ZP_VB_STUB)            ; 片付けはBCOSにやらせる

NOTES:
  .BYTE 40,3
  .BYTE 41,6
  .BYTE 42,3
  .BYTE 43,6
  .BYTE 44,6
  .BYTE 45,6
  .BYTE 46,6
  .BYTE 47,6
  .BYTE 48,6

